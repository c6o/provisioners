name: Snipe-It
appId:  snipeit
package: '@provisioner/appengine'
icon: icon.svg
summary:
  Snipe-IT was made for IT asset management, to enable IT departments to track who has which laptop, when it was purchased, which software licenses and accessories are available, and so on.

description:
  Snipe-IT was made for IT asset management, to enable IT departments to track who has which laptop, when it was purchased, which software licenses and accessories are available, and so on.


  [Read more on the Overview Page](https://snipe-it.readme.io/docs/overview)



  Setup

  ----

  Snipe-It requires access to a MySql or MariaDB database along with a user with 'mysql_native_password' authentication.  This has been created prior to the installation.


  Here is a sample script to get you started with MySql


    ~~~~

    CREATE DATABASE snipeit;

    CREATE USER 'snipeit'@'%' IDENTIFIED BY '88888888';

    ALTER USER 'snipeit'@'%' IDENTIFIED WITH mysql_native_password BY '88888888';

    GRANT ALL PRIVILEGES ON snipeit.* TO 'snipeit'@'%';

    FLUSH PRIVILEGES;

    SELECT User, Plugin FROM mysql.user;

    ~~~~

    Be sure to change the value '88888888' with a secure password.



category: cms
keywords:
  - wiki

repo: https://github.com/Requarks/wiki
license: https://github.com/Requarks/wiki/blob/dev/LICENSE
support: https://github.com/Requarks/wiki/issues

provisioner:
  repo: https://github.com/c6o/provisioners
  support: https://github.com/c6o/provisioners/issues

editions:
  - name: latest
    status: public
    default: true
    spec:
      routes:
        - type: http
          targetService: snipeit
        - type: tcp
          targetService: db-connection
      provisioner:
        package: '@provisioner/appengine'
        image: snipe/snipe-it
        tag-prefix: appengine
        port: 80
        automated: true
        flow:
            inquire:
              - type: input
                name: DB_HOST
                message: The name of the database server (Service)
                default: mysql.database
                c6o:
                  label: Database Host
              - type: number
                name: DB_PORT
                message: The port of the database
                default: 3306
                c6o:
                  label: Database Port
              - type: input
                name: DB_DATABASE
                message: The name of the database to use
                default: snipeit
                c6o:
                  label: Database name
              - type: input
                name: DB_USERNAME
                message: The database user name
                default: snipeit
                c6o:
                  label: Database user name
              - type: password
                name: DB_PASSWORD
                message: The database user password
                c6o:
                  label: Database user password
                  target: secret
              - type: input
                name: APP_KEY
                message: App encryption key
                c6o:
                  target: secret
                  generate:
                    length: 16
        config:
          - name: DB_HOST
            label: Database Host
            hint: The name of the database server (Service)
            required: true
            autoselect: true
            fieldType: DNS
            value: mysql.database


          - name: DB_PORT
            label: Database Port
            hint: The port of the database
            required: true
            autoselect: true
            fieldType: text
            value: 3306


          - name: DB_DATABASE
            label: Database name
            hint: The name of the database to use
            required: true
            autoselect: true
            fieldType: text
            value: snipeit

          - name: DB_USERNAME
            label: Database user name
            hint: The username for the database user
            required: true
            autoselect: true
            fieldType: text
            value: snipeit

        secret:
          - name: DB_PASSWORD
            label: Database password
            hint: The password for the database user
            required: true
            autoselect: true
            fieldType: password

          - name: APP_KEY
            value: $RANDOM:32
      marina:
        launch:
          type: inline
          popUp: true

  - name: preview
    status: public
    default: true
    spec:
      routes:
        - type: http
          targetService: snipeit
      provisioner:
        package: '@provisioner/appengine'
        image: snipe/snipe-it
        tag-prefix: appengine
        port: 80
        automated: true

#stages:
#1. Scan all "features", and create specs internally for each
#2. Take the "values" and apply them to each features spec
#3. Apply all features into the cluster
#4. Apply the "script" section to the feature.  This will be very hard coded
#5. Take the finished spec from each feature, and apply mappings to the App being installed
#6. Install the App requested

#Drawback, cant map values from one feature to another
#Scripts and their relationship with the feature will be very fixed (mysql, mariadb, etc..)  AppEngine will need to support all database types and such to execute these scripts against


        link:
            #WHICH DEPENDANCIES/FEATURES TO INSTALL
            dependancies:
              - name: mysql
                spec:
                  edition: internal
                  package: '@provisioner/appengine'
                  tag-prefix: appengine
                  tag: latest
                  image: mysql
                  ports:
                    - port: 3306
                      protocol: TCP
                      name: mysql
                  volumes:
                    - size: 5Gi
                      mountPath: /data
                      name: mysql-data
                #POST INSTALL THE FEATURE
                  #RUN THE SCRIPT AGAINST THE DATABASE
                  #CAPTURE OUTPUT, CONSOLE.LOG THE RESULT
                  scripts:
                      - script: CREATE DATABASE snipeit;
                      - script: CREATE USER 'snipeit'@'%' IDENTIFIED BY '88888888';
                      - script: ALTER USER 'snipeit'@'%' IDENTIFIED WITH mysql_native_password BY '88888888';
                      - script: GRANT ALL PRIVILEGES ON snipeit.* TO 'snipeit'@'%';
                      - script: FLUSH PRIVILEGES;

                  #RUN THE SCRIPT AGAINST THE CLUSTER/NAMESPACE/POD
                  #kubectl exec shell-demo -- ls -la
                  #will take the output and console.log the result
                  # command:
                  #   ls -la
              #PRE INSTALL FEATURES
            values:
              - item:
                  source:
                      value: $RANDOM:32
                  destination:
                      name: mysql
                      type: secrets
                      field: MYSQL_ROOT_PASSWORD
              - item:
                  source:
                      value: 3306
                  destination:
                      name: snipeit
                      type: configs
                      field: DB_PORT

              - item:
                  source:
                      value: 3306
                  destination:
                      name: mysql
                      type: configs
                      field: DB_PORT

              - item:
                  source:
                      value: snipeit
                  destination:
                      name: snipeit
                      type: configs
                      field: DB_DATABASE

              - item:
                  source:
                      value: snipeit
                  destination:
                      name: snipeit
                      type: configs
                      field: DB_USERNAME

              - item:
                  source:
                    value: '88888888'
                  destination:
                      name: snipeit
                      type: secrets
                      field: DB_PASSWORD

              - item:
                  source:
                      value: $RANDOM:32
                  destination:
                      name: snipeit
                      type: configs
                      field: APP_KEY

            #POST INSTALL ALL FEATURES, PRE INSTALL APP
            mappings:
              - item:
                  source:
                    name: mysql
                    type: configs
                    field: DB_HOST
                  destination:
                      name: snipeit
                      type: configs
                      field: DB_HOST

      marina:
        launch:
          type: inline
          popUp: true

